trigger:
  branches:
    include:
      - main
  paths:
    include:
      - src/api/*
      - src/shared/*
      - test/api/*
      - azure-pipelines-api.yml
      - Api.Dockerfile

pr: none

pool:
  vmImage: 'ubuntu-20.04'

variables:
  - name: 'DOCKER_FILE'
    value: 'Api.Dockerfile'
  - name: 'DOCKER_REGISTRY'
    value: 'dockerhub'
  - name: 'DOCKER_REPOSITORY'
    value: 'nomanova/ojeda-api'

steps:
  - task: Docker@2
    displayName: 'Build Image'
    inputs:
      command: build
      containerRegistry: '$(DOCKER_REGISTRY)'
      repository: '$(DOCKER_REPOSITORY)'
      Dockerfile: '$(DOCKER_FILE)'
      tags: |
        $(Build.BuildId)
        latest
  - task: Docker@2
    displayName: 'Push Image'
    inputs:
      command: push
      containerRegistry: '$(DOCKER_REGISTRY)'
      repository: '$(DOCKER_REPOSITORY)'
      tags: |
        $(Build.BuildId)
        latest
