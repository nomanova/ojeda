@page "/admin/field-sets"
@layout AdminLayout
@inherits ListItemsPage<FieldSetDto>

@inject OjedaClient Ojeda

<OjedaBreadcrumb Data="@_breadcrumbItems" />

<h3>Field Sets</h3>

<div class="d-flex justify-content-between my-3">

    <div class="d-flex">
        <div style="width: 350px;">
            <Search OnValueChanged="@OnSearchAsync"></Search>
            </div>
        <button class="btn btn-primary ms-2" @onclick="OnAdd">Add Field Set</button>
    </div>
        
        <Spinner IsLoading="@IsLoading" />
    
</div>

@if (Items == null)
{
    <p class="text-muted fst-italic">Loading...</p>   
}
else if (!Items.Any())
{
    if (string.IsNullOrEmpty(SearchQuery))
    {
        <p class="text-muted fst-italic">No items available.</p>
    }
    else
    {
        <p class="text-muted fst-italic">No search results.</p>
    }
}
else
{
    <ActionsTableTemplate TItem="FieldSetDto" 
                          Items="@Items" 
                          EditItemCallBack="@OnEdit"
                          DeleteItemCallBack="@OnDelete">
        <TableHeader>
            <th>Name</th>
            <th>Description</th>
            <th># Fields</th>
        </TableHeader>
        <RowTemplate Context="fieldSet">
            <td>@fieldSet.Name</td>
            <td><Description Value="@fieldSet.Description"/></td>
            <td>@fieldSet.Fields.Count</td>
        </RowTemplate>
    </ActionsTableTemplate>

    <div class="my-4">
        <OjedaPager
            PageCount="@PageCount"
            CurrentPage="@CurrentPage"
            PageSize="@PageSize"
            TotalCount="@TotalCount"
            OnPageChanged="@OnPageChanged"
            OnPageSizeChanged="@OnPageSizeChanged" />
    </div>
}

@code {
    
    private readonly ICollection<BreadcrumbItem> _breadcrumbItems = new List<BreadcrumbItem>
    {
        new () {Text = "Admin", Url = "/admin"},
        new () {Text = "Field Sets"}
    };
    
    protected override string Path => "/admin/field-sets";

    protected override async Task<OjedaResult> DeleteItemAsync(FieldSetDto item)
    {
        return await Ojeda.FieldSetsService.DeleteAsync(item.Id);
    }

    protected override async Task<OjedaDataResult<PaginatedListDto<FieldSetDto>>> FetchItemsAsync(string query = null,
        int pageNumber = Constants.DefaultPageNumber,
        int pageSize = Constants.DefaultPageSize)
    {
        return await Ojeda.FieldSetsService.GetAsync(query, null, true, null, pageNumber, pageSize);
    }
}
