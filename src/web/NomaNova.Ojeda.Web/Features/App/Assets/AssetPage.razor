@page "/assets/{AssetId}"

@inject OjedaClient _ojeda
@inject NavigationManager _navManager
@inject IToastService _toastService

<div class="d-flex justify-content-between mt-2 mb-3">
    <div class="d-flex align-items-center">
        <h3 class="m-0">Asset</h3>
    </div>
    <div class="d-flex">
        <OjedaButton
            Text="Delete"
            Style="@ButtonStyle.Danger"
            OnClick="OnDelete"
            IsLoading="_isLoading"
            IsDisabled="_isLoading"/>
    </div>
</div>

<AssetTabSelector OnTabChanged="@OnTabChanged"/>

<AssetTabSwitcher Tab="_tab">
    <FieldsTemplate>
        <AssetFieldsTab AssetId="@AssetId"/>
    </FieldsTemplate>
    <NotesTemplate>
        <AssetNotesTab AssetId="@AssetId"/>
    </NotesTemplate>
</AssetTabSwitcher>

@code {

    private bool _isLoading;

    private AssetTab _tab = AssetTab.Fields;

    [Parameter]
    public string AssetId { get; set; }

    private void OnTabChanged(AssetTab tab)
    {
        Console.WriteLine($"tab changed to: {tab}");

        _tab = tab;
    }

    private async Task OnDelete()
    {
        _isLoading = true;

        var result = await _ojeda.AssetsService.DeleteAsync(AssetId);

        if (result.Success)
        {
            _navManager.NavigateTo("/assets");
        }
        else
        {
            _toastService.ShowError($"Could not delete asset. {result.Error?.Message} ({result.Error?.Code}).");
        }

        _isLoading = false;
    }

}